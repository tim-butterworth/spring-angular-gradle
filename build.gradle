group = 'com.example'
version = '0.0.1-SNAPSHOT'

def clientTest = project.getTasks().getByPath(":applications/angular-app:testJs")
def clientBuild = project.getTasks().getByPath(":applications/angular-app:buildJs")
def clientClean = project.getTasks().getByPath(":applications/angular-app:cleanJs")

def serverBuild = project.getTasks().getByPath(":applications/server:build")
def serverTest = project.getTasks().getByPath(":applications/server:test")
def serverClean = project.getTasks().getByPath(":applications/server:clean")

def bootRun = project.getTasks().getByPath(":applications/server:bootRun")

task copyJsToServer(type: Copy) {
    from 'applications/angular-app/dist'
    into 'applications/server/src/main/resources/public'
}

task clean(type: Exec) {
    workingDir("applications/server/src/main/resources")

    commandLine('rm', '-rf', 'public')
}

task buildAll {
    dependsOn clientTest
    dependsOn clientBuild
    dependsOn copyJsToServer
    dependsOn serverBuild

    serverBuild.mustRunAfter(copyJsToServer)
    copyJsToServer.mustRunAfter(clientBuild)
    clientBuild.mustRunAfter(clientTest)
}

task buildAndRunServer {
    dependsOn clientTest
    dependsOn clientBuild
    dependsOn copyJsToServer
    dependsOn bootRun

    bootRun.mustRunAfter(copyJsToServer)
    copyJsToServer.mustRunAfter(clientBuild)
    clientBuild.mustRunAfter(clientTest)
}

task testAll {
    dependsOn clientTest
    dependsOn serverTest

    serverTest.mustRunAfter(clientTest)
}

task cleanAll {
    dependsOn clientClean
    dependsOn serverClean
}